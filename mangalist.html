<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>My Manga List</title>

<style>
body {
  font-family: Arial;
  padding: 30px;
  background: #f5f5f5;
}

.controls {
  margin-bottom: 20px;
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
}

input, select {
  padding: 6px;
}

.grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
  gap: 15px;
}

.card {
  background: white;
  border-radius: 8px;
  padding: 15px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}

.card img {
  width: 100%;
  height: 150px;
  object-fit: cover;
  border-radius: 6px;
}

.price {
  color: green;
  font-weight: bold;
  margin-top: 5px;
}
</style>
</head>

<body>

<h1>My Manga</h1>

<div class="controls">
  <input type="text" id="searchInput" placeholder="Search title..." oninput="applyFilters()">

  <select id="publisherFilter" onchange="applyFilters()">
    <option value="">All Publishers</option>
  </select>
<!--
  <select id="sortPrice" onchange="applyFilters()">
    <option value="">Sort by Price</option>
    <option value="low">Low → High</option>
    <option value="high">High → Low</option>
  </select> -->
</div>

<div class="grid" id="mangalist">Loading...</div>

<script>
const SHEET_URL = "https://opensheet.elk.sh/1Ker7vSVvehFJw_D7271lONLKs3b0UGj7OIF2aHK3kG8/MangaList";
let sheetData = [];

fetch(SHEET_URL)
  .then(res => res.json())
  .then(data => {

    // Only keep Active = Yes
    sheetData = data.filter(row =>
      row.Active?.toLowerCase() === "yes"
    );

    populatePublishers();
    applyFilters();
  })
  .catch(error => {
    document.getElementById("mangalist").innerHTML = "Failed to load data.";
    console.error(error);
  });

function populatePublishers() {
  const publisherSelect = document.getElementById("publisherFilter");

  const publishers = [...new Set(sheetData.map(row => row.Publisher))];

  publishers.forEach(pub => {
    const option = document.createElement("option");
    option.value = pub;
    option.textContent = pub;
    publisherSelect.appendChild(option);
  });
}

function applyFilters() {

  const search = document.getElementById("searchInput").value.toLowerCase();
  const publisher = document.getElementById("publisherFilter").value;
//  const sort = document.getElementById("sortPrice").value; 

  let filtered = sheetData.filter(row => {

    const searchMatch =
      row.Title?.toLowerCase().includes(search);

    const publisherMatch =
      publisher === "" || row.Publisher === publisher;

    return searchMatch && publisherMatch;
  });

  // Sort price
  //if (sort === "low") {
  //  filtered.sort((a,b) => Number(a.Price) - Number(b.Price));
  //}

  //if (sort === "high") {
  //  filtered.sort((a,b) => Number(b.Price) - Number(a.Price));
  //}

  const html = filtered.map(row => `
    <div class="card">
      <img src="${row.Image}" alt="${row.Title}">
      <h3>書名: ${row.Title} #${row.Volume}</h3>
      <h4>${row.Subtitle}</h4>
      <div>作者: ${row.Author}</div>
      <div>出版社: ${row.Publisher}</div>
      <div>尺碼: ${row.Size}</div>
      <div class="date">出版日期: ${row.IssueDate}</div>
      <div class="price">價格: $${row.Price}</div>
      <div>頁數: ${row.Page}</div>
      <div>ISBN: ${row.ISBN}</div>
      <div>日文書名: ${row.OriginalTitle} #${row.Volume}</div>
      <div>日文副題: ${row.OriginalSubtitle}</div>
    </div>
  `).join("");

  document.getElementById("mangalist").innerHTML =
    filtered.length ? html : "No Manga found.";
}
</script>

</body>
</html>
